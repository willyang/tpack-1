# HTML 压缩插件
使用 [html-minifier](https://github.com/kangax/html-minifier) 压缩优化 HTML

## 安装
此插件已内置，无需安装。
启用优化时，如果项目里存在 `.html` 或 `.htm` 文件，TPack 会自动安装 html-minifier 并压缩 HTML。

或者你也可以手动安装 html-minifier：`npm install html-minifier --save-dev`

## 配置
```js
export default {
	optimizers: [
		{
			match: "*.html",
			use: "tpack/optimizers/html",
			options: { /* 可选的附加选项，详见下文 */ }
		}
	]
}
```

### 附加选项
```js
{
	caseSensitive: false, 	            	// 区分大小写
	collapseBooleanAttributes: false,   	// 是否删除布尔型属性值。如 disabled="disabled" → disabled
	collapseInlineTagWhitespace: false, 	// 删除内联(默认display:inline)标签中间的空白。仅当 collapseWhitespace=true 时有效
	collapseWhitespace: true,               // 删除节点间的空白字符
	conservativeCollapse: null,             // 是否在删除空白字符时保留一个空格。 仅当 collapseWhitespace=true 时有效
	customAttrAssign: [],                   // 正则表达式数组，自定义属性赋值表达式。如 <div flex?="{{mode != cover}}"></div>
	customAttrCollapse: null,               // 正则表达式，指定删除空行的属性。如 /ng-class/
	customAttrSurround: [],                 // 正则表达式数组，包含自定义属性前后缀。 如 <input {{#if value}}checked="checked"{{/if}}>
	customEventAttributes: [/^on[a-z]{3,}$/],  // 正则表达式数组，包含自定义事件属性。主要用于提取 JS 代码以压缩。 如 ng-click
	decodeEntities: false,                  // 直接用法 Unicode 字符，而非转义字符
	html5: true,                            // 根据 HTML5 规范解析文档
	ignoreCustomComments: [/^!/],           // 正则表达式数组，匹配的注释将不被处理
	ignoreCustomFragments: [/<%[\s\S]*?%>/, /<\?[\s\S]*?\?>/],  // 正则表达式数组，匹配的标签将不被处理。 (如 <?php ... ?>, {{ ... }}
	includeAutoGeneratedTags: true,         // 插入 HTML 解析器自动生成的标签
	keepClosingSlash: false,                // 保留自结束标签的 /。如 <link /> 中的 /
	maxLineLength: null,                    // 指定压缩输出的最大行数。 代码会在标签位置自动换行
	minifyURLs: false,                      // 是否压缩地址 (用法 relateurl)(可以是 true, Object 或 (text, inline) => string)
	preserveLineBreaks: false,              // 是否在删除空白字符时保留至少一个换行。 仅当 collapseWhitespace=true 时有效
	preventAttributesEscaping: false,       // 禁止编码属性值
	processConditionalComments: false,      // 处理条件注释
	processScripts: [],                     // 包含脚本的 script type 类型。 如 text/ng-template, text/x-handlebars-template
	quoteCharacter: '\'',                   // 属性名用法的默认引号(' 或 ")
	removeAttributeQuotes: false,           // 删除 HTML 属性的引号，如果无法删除则不删除
	removeComments: true,                   // 删除 HTML 注释
	removeEmptyAttributes: false,           // 删除只包含空白字符的属性
	removeEmptyElements: false,             // 删除空元素
	removeOptionalTags: false,              // 删除可选标签
	removeRedundantAttributes: false,       // 删除默认属性值
	removeScriptTypeAttributes: false,      // 删除 script 标签的 type="text/javascript" 属性，保留其它 type 类型
	removeStyleLinkTypeAttributes: false,   // 删除 style 标签的 type="text/css" 属性，保留其它 type 类型
	removeTagWhitespace: false,             // 删除属性之间的空白。注意这会导致生成非标准的 HTML
	sortAttributes: false,                  // 根据用法频率对属性重新排序
	sortClassName: false,                   // 根据用法频率对 class 名重新排序
	useShortDoctype: false                  // 将 doctype 替换为 HTML5 的简短 doctype
	
	// 以下选项已在插件内部设置，不建议用户修改
	minifyCSS: false,                       // 是否压缩内联的 CSS (用法 clean-css)(可以是 true, Object 或 (text, inline) => string)
	minifyJS: false,                        // 是否压缩内联的 JS (用法 UglifyJS) (可以是 true, Object 或 (text, inline) => string)
}
```
完整最新的配置请参考: [官方文档](https://github.com/kangax/html-minifier)

## 使用
使用 `tpack -p` 或在配置中添加 `{optimize: true}` 启用压缩

所有 HTML 文件都会被压缩，HTML 内联的 CSS 和 JS 将按 `.css` 和 `.js` 的配置压缩

> #### 注意：HTML 压缩可能造成副作用
> HTML 的空白和注释是 HTML 节点树的一部分，压缩可能会使得 HTML 结构发生变化。